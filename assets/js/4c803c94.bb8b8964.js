"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[95537],{28453(e,n,t){t.d(n,{R:()=>r,x:()=>l});var o=t(96540);const i={},s=o.createContext(i);function r(e){const n=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:n},e.children)}},61921(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"odp/python/developer/extension_types/plugins","title":"OBBject Plugins","description":"This page provides information about how to write plugin extensions that intercept the application output immediately before returning to the user. They provide a way to conditionally alter the output of any command, including those you do not control.","source":"@site/content/odp/python/developer/extension_types/plugins.md","sourceDirName":"odp/python/developer/extension_types","slug":"/odp/python/developer/extension_types/plugins","permalink":"/odp/python/developer/extension_types/plugins","draft":false,"unlisted":false,"editUrl":"https://github.com/OpenBB-finance/openbb-docs/edit/main/content/odp/python/developer/extension_types/plugins.md","tags":[],"version":"current","lastUpdatedBy":"Danglewood","lastUpdatedAt":1771262401000,"sidebarPosition":4,"frontMatter":{"title":"OBBject Plugins","sidebar_position":4,"description":"This page provides information about how to write plugin extensions that intercept the application output immediately before returning to the user. They provide a way to conditionally alter the output of any command, including those you do not control.","keywords":["develop","OBBject","Python","API","plugin","callback","on_command_output","allow_mutable_extensions","ODP","extensions","obbject extension","accessor","decorator","how-to"]},"sidebar":"tutorialSidebar","previous":{"title":"OBBject Extensions","permalink":"/odp/python/developer/extension_types/obbject"},"next":{"title":"Charting Extensions","permalink":"/odp/python/developer/extension_types/charting"}}');var i=t(74848),s=t(28453),r=t(94331);const l={title:"OBBject Plugins",sidebar_position:4,description:"This page provides information about how to write plugin extensions that intercept the application output immediately before returning to the user. They provide a way to conditionally alter the output of any command, including those you do not control.",keywords:["develop","OBBject","Python","API","plugin","callback","on_command_output","allow_mutable_extensions","ODP","extensions","obbject extension","accessor","decorator","how-to"]},a=void 0,c={},d=[{value:"Folder structure",id:"folder-structure",level:2},{value:"TOML File",id:"toml-file",level:3},{value:"Configuring Extension",id:"configuring-extension",level:2},{value:"Extension Code",id:"extension-code",level:2},{value:"Install Extension",id:"install-extension",level:2},{value:"Use Extension",id:"use-extension",level:2}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.A,{title:"Build OBBject Plugin Extensions - Developer | OpenBB Docs"}),"\n",(0,i.jsx)(n.p,{children:"This page provides information about how to write plugin extensions\nthat intercept the application output immediately before returning to the user.\nThey provide a way to conditionally alter the output of any command, including those you do not control."}),"\n",(0,i.jsxs)(n.p,{children:["While OBBject ",(0,i.jsx)(n.a,{href:"/odp/python/developer/extension_types/obbject",children:"extensions"})," are post-return methods for the Python Interface,\nOBBject plugins are compatible with both interfaces, REST API and Python, and execute before returning.\nThey give the developer complete control of the application's last-mile delivery.\nBecause of this, they are considered potentially dangerous, and may allow arbitrary code execution in the installed environment."]}),"\n",(0,i.jsx)(n.admonition,{type:"danger",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"OpenBB does not publish any package using these features."})}),"\n",(0,i.jsxs)(n.li,{children:["The user must explicitly allow this type of functionality in the environment or ",(0,i.jsx)(n.code,{children:"system_settings.json"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"The application will not start if a plugin extension is installed and the environment is not configured."}),"\n",(0,i.jsx)(n.li,{children:"Changes will not be reflected in the function's signature and docstring."}),"\n"]})}),"\n",(0,i.jsx)(n.p,{children:"Workflows can be orchestrated by registering multiple callbacks, executed in the order of insertion.\nTasks are performed in series or parallel, where series operations are blocking events."}),"\n",(0,i.jsxs)(n.p,{children:["In ",(0,i.jsx)(n.a,{href:"/odp/python/settings/system_settings",children:"system_settings.json"}),", add:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "allow_on_command_output": true,\n  "allow_mutable_extensions": true,\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["They can also be set as environment variables, prefixed with ",(0,i.jsx)(n.code,{children:"OPENBB_"})]}),"\n",(0,i.jsx)(n.h2,{id:"folder-structure",children:"Folder structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"obbject_plugin_example\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 openbb_empty_plugin\n\u2502   \u2514\u2500\u2500 __init__.py\n\u251c\u2500\u2500 poetry.lock\n\u2514\u2500\u2500 pyproject.toml\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Extension code can go directly in the ",(0,i.jsx)(n.code,{children:"__init__.py"})," file."]}),"\n",(0,i.jsx)(n.h3,{id:"toml-file",children:"TOML File"}),"\n",(0,i.jsx)(n.p,{children:"The entry point for the extension is specified as a Poetry plugin, near the bottom of the file."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[tool.poetry.plugins."openbb_obbject_extension"]\nempty_plugin = "openbb_empty_plugin:plugin"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["A complete ",(0,i.jsx)(n.code,{children:"pyproject.toml"})," looks something like:"]}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsxs)("summary",{mdxType:"summary",children:[(0,i.jsx)(n.code,{children:"pyproject.toml"})," "]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[tool.poetry]\nname = "openbb-empty-plugin"\nversion = "0.0.0"\ndescription = "An empty OBBject plugin extension"\nauthors = ["Hello <hello@world.com>"]\nreadme = "README.md"\npackages = [{ include = "openbb_empty_plugin" }]\n\n[tool.poetry.dependencies]\npython = "^3.10,<3.14"\nopenbb-core = "*"\n\n[build-system]\nrequires = ["poetry-core"]\nbuild-backend = "poetry.core.masonry.api"\n\n[tool.poetry.plugins."openbb_obbject_extension"]\nempty_plugin = "openbb_empty_plugin:plugin"\n'})})]}),"\n",(0,i.jsx)(n.p,{children:"Command execution triggers the callable accessor defined as the entrypoint."}),"\n",(0,i.jsx)(n.h2,{id:"configuring-extension",children:"Configuring Extension"}),"\n",(0,i.jsx)(n.p,{children:"By default, it applies to all application endpoints.\nIndividual endpoints can be targeted by setting initialization parameters."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Parameters\n----------\nname : str\n    Name of the extension.\ncredentials : list[str], optional\n    List of required credentials, by default None\ndescription: Optional[str]\n    Extension description.\non_command_output : bool, optional\n    Whether the extension acts on command output, by default False\ncommand_output_paths : list[str], optional\n    List of endpoint paths the extension acts on, where None means all, by default None.\nimmutable : bool, optional\n    Whether the function output is immutable, by default True.\nresults_only : bool, optional\n    Whether the extension returns only the results instead of the OBBject, by default False.\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"important",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"on_command_output"})," ",(0,i.jsx)(n.strong,{children:"must"})," be set as True."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"immutable"})," ",(0,i.jsx)(n.strong,{children:"must"})," be set as False to alter the response object."]}),"\n"]})}),"\n",(0,i.jsx)(n.h2,{id:"extension-code",children:"Extension Code"}),"\n",(0,i.jsxs)(n.admonition,{type:"important",children:[(0,i.jsxs)(n.p,{children:["Registered ",(0,i.jsx)(n.code,{children:"on_command_output"})," callables should:"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'Accept "obbject" as the only positional argument.'}),"\n",(0,i.jsx)(n.li,{children:"Modify the OBBject item directly, where required, even if it is not returned in the end."}),"\n",(0,i.jsxs)(n.li,{children:["Have no ",(0,i.jsx)(n.code,{children:"return"}),"."]}),"\n"]}),(0,i.jsxs)(n.p,{children:["Plugins are compatible only with endpoints returning an ",(0,i.jsx)(n.code,{children:"OBBject"}),", and are not executable after returning."]})]}),"\n",(0,i.jsxs)(n.p,{children:["Each entrypoint is an instance of the ",(0,i.jsx)(n.code,{children:"Extension"})," class, and is applied as a decorator."]}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{mdxType:"summary",children:"Basic Example"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'"""OBBject Plugin Extension Example."""\n\nfrom openbb_core.app.model.extension import Extension\nfrom openbb_core.app.model.obbject import OBBject\n\n\nempty_plugin = Extension(\n    name="empty_plugin",\n    credentials=None,\n    description="An on-command output extension that does nothing.",\n    on_command_output=True,  # Must be set as True\n    command_output_paths=None,  # Add a list of paths - i.e, ["/equity/price/historical"]\n    immutable=False,  # Must be set as False if you intend to alter the output.\n    results_only=False,  # Use this as a flag to automatically return only the "results" portion of the OBBject.\n)\n\n@empty_plugin.obbject_accessor\nclass EmptyPlugin:\n    """Empty plugin accessor."""\n\n    def __init__(self, obbject: OBBject):\n        """Initialize EmptyOBBject."""\n        self._obbject = obbject\n\n    def __call__(self):\n        """Do nothing and return None."""\n        # Get access to the execution context from the OBBject itself.\n        print(self._obbject._extra_params)\n        print(\n            "This is my OBBject extension that is triggered on command output.\\n"\n            "You can mutate the results or pass them to another process, like adding to a database.\\n"\n            "You can also choose which commands to trigger this extension on.\\n"\n            f"Command executed: {self._obbject.extra[\'metadata\']}"\n        )\n        self._obbject.results = None\n'})})]}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{mdxType:"summary",children:"Advanced Example"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'"""Non-Blocking OBBject Plugin Extension Example."""\n\nimport threading\nimport time\n\nfrom openbb_core.app.model.extension import Extension\nfrom openbb_core.app.model.obbject import OBBject\n\nnonblocking_plugin = Extension(\n    name="nonblocking_plugin",\n    description="An on-command-output plugin simulating an expensive task performed in a separate thread.",\n    on_command_output=True,  # Must be set as True\n    command_output_paths=None, # Add a list of paths - i.e, ["/equity/price/historical"]\n    immutable=True,  # Set to `True`, or omit, for parallel processing.\n    results_only=False,  # Use this as a flag to return only the "results" portion of the OBBject.\n)\n\n\ndef _expensive_operation_worker(serialized_obbject: dict):\n    """Simulate a long-running task without blocking the caller."""\n    working_copy = OBBject(**serialized_obbject)\n    print("\\nThis is the deserialized OBBject in the non-blocking thread.")\n    print(working_copy.__repr__())\n    for i in range(10):\n        print(str(i) + " seconds remaining...")\n        time.sleep(1)\n    print("Expensive operation is now complete.")\n\n\n@nonblocking_plugin.obbject_accessor\ndef nonblocking_plugin_function(obbject):  # This could also be an async function.\n    """Simulated on_commnd_output function that executes an expensive task\n    in a non-blocking thread."""\n    obbject.results = None\n    print(\n        "Serializing the obbject and passing to a new thread.\\n"\n        f"Command executed: {obbject.extra[\'metadata\']}\\n"\n    )\n    print(\n        "Simulating an expensive task that is non-blocking and allows the function to return."\n    )\n    threading.Thread(\n        target=_expensive_operation_worker,\n        args=(obbject.model_dump(),),\n        name="nonblocking-plugin-expensive-operation",\n        daemon=False,\n    ).start()\n'})})]}),"\n",(0,i.jsx)(n.h2,{id:"install-extension",children:"Install Extension"}),"\n",(0,i.jsx)(n.p,{children:"With the code structure in place, install the extension into the an environment where OpenBB is already installed."}),"\n",(0,i.jsxs)(n.p,{children:["Navigate into the folder where the ",(0,i.jsx)(n.code,{children:"pyproject.toml"})," file is, open a terminal, and enter:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"pip install -e .\nopenbb-build\n"})}),"\n",(0,i.jsx)(n.h2,{id:"use-extension",children:"Use Extension"}),"\n",(0,i.jsx)(n.p,{children:"Start the API server or Python Interface and run the affected commands, adjust the code as required."})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},94331(e,n,t){t.d(n,{A:()=>s});t(96540);var o=t(5260),i=t(74848);function s({title:e}){return(0,i.jsx)(o.A,{children:(0,i.jsx)("title",{children:e})})}}}]);