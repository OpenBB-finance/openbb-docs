"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[84380],{28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>r});var o=n(96540);const a={},i=o.createContext(a);function s(e){const t=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),o.createElement(i.Provider,{value:t},e.children)}},67948:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"workspace/custom-backend/Widgets/chart/plotly","title":"Plotly Chart","description":"Learn how to integrate your own backend with OpenBB Workspace using the cookie-cutter or language-agnostic API approaches, with illustrative guides and principles for handling widget.json files, APIs, interfaces, Python, FastAPI, and more.","source":"@site/content/workspace/custom-backend/Widgets/chart/plotly.md","sourceDirName":"workspace/custom-backend/Widgets/chart","slug":"/workspace/custom-backend/Widgets/chart/plotly","permalink":"/workspace/custom-backend/Widgets/chart/plotly","draft":false,"unlisted":false,"editUrl":"https://github.com/OpenBB-finance/openbb-docs/edit/main/content/workspace/custom-backend/Widgets/chart/plotly.md","tags":[],"version":"current","lastUpdatedBy":"Theodore Aptekarev","lastUpdatedAt":1745833196000,"sidebarPosition":2,"frontMatter":{"title":"Plotly Chart","sidebar_position":2,"description":"Learn how to integrate your own backend with OpenBB Workspace using the cookie-cutter or language-agnostic API approaches, with illustrative guides and principles for handling widget.json files, APIs, interfaces, Python, FastAPI, and more.","keywords":["widgets.json","OpenBB API","Endpoint integration","widget configuration","Language-Agnostic API","API implementation","Python","FastAPI","Workspace widgets","Widget definitions"]},"sidebar":"tutorialSidebar","previous":{"title":"Native Chart","permalink":"/workspace/custom-backend/Widgets/chart/native"},"next":{"title":"Advanced Charting","permalink":"/workspace/custom-backend/Widgets/advanced_charting"}}');var a=n(74848),i=n(28453);const s={title:"Plotly Chart",sidebar_position:2,description:"Learn how to integrate your own backend with OpenBB Workspace using the cookie-cutter or language-agnostic API approaches, with illustrative guides and principles for handling widget.json files, APIs, interfaces, Python, FastAPI, and more.",keywords:["widgets.json","OpenBB API","Endpoint integration","widget configuration","Language-Agnostic API","API implementation","Python","FastAPI","Workspace widgets","Widget definitions"]},r="Plotly Chart",d={},c=[{value:"Step 1: Set Up Your Project",id:"step-1-set-up-your-project",level:2},{value:"Step 2: Create the Chart Endpoint",id:"step-2-create-the-chart-endpoint",level:2},{value:"Edit the widgets.json File",id:"edit-the-widgetsjson-file",level:3},{value:"Step 3: Run the Application",id:"step-3-run-the-application",level:2},{value:"Step 4: Add to OpenBB Pro",id:"step-4-add-to-openbb-pro",level:2},{value:"Theme",id:"theme",level:3},{value:"Additional Resources",id:"additional-resources",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"plotly-chart",children:"Plotly Chart"})}),"\n",(0,a.jsx)(t.p,{children:"This guide will walk you through the process of creating a chart widget for OpenBB Workspace. We will be using Plotly to create the chart in our example. By the end of this guide, you will have a working chart widget that you can add to OpenBB."}),"\n",(0,a.jsx)(t.h2,{id:"step-1-set-up-your-project",children:"Step 1: Set Up Your Project"}),"\n",(0,a.jsx)(t.p,{children:"To get started, create the main application file and the widget configuration file. You will only need these two files:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"main.py"}),": This file will contain your FastAPI application code."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"widgets.json"}),": This file will define the configuration for your widget."]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["The backend will use the same FastAPI setup and structure as described in the ",(0,a.jsx)(t.a,{href:"/workspace/custom-backend/",children:"Custom Backend"})," page."]}),"\n",(0,a.jsx)(t.h2,{id:"step-2-create-the-chart-endpoint",children:"Step 2: Create the Chart Endpoint"}),"\n",(0,a.jsxs)(t.p,{children:["Edit the ",(0,a.jsx)(t.code,{children:"main.py"})," file and add the following code. This code sets up a FastAPI application with an endpoint to serve the widget configuration and data for a chart:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:'...\n# Chart endpoint\n@app.get("/chains")\ndef get_chains():\n    """Fetch and display the current TVL of all chains using Defi Llama."""\n    params = {}\n    response = requests.get("https://api.llama.fi/v2/chains", params=params)\n\n    if response.status_code == 200:\n        # Create a DataFrame from the JSON data\n        df = pd.DataFrame(response.json())\n\n        # Sort the DataFrame by \'tvl\' in descending order and select the top 30\n        top_30_df = df.sort_values(by=\'tvl\', ascending=False).head(30)\n\n        # Create a bar chart using Plotly\n        figure = go.Figure(\n            data=[go.Bar(x=top_30_df["tokenSymbol"], y=top_30_df["tvl"])],\n            layout=go.Layout(\n                title="Top 30 Chains by TVL",\n                xaxis_title="Token Symbol",\n                yaxis_title="Total Value Locked (TVL)"\n            )\n        )\n\n        # Convert the Plotly figure to JSON format for frontend rendering\n        # This is a crucial step that allows the figure to be displayed in OpenBB Workspace\n        return json.loads(figure.to_json())\n\n    print(f"Request error {response.status_code}: {response.text}")\n    return JSONResponse(\n        content={"error": response.text}, status_code=response.status_code\n    )\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Because we are using Plotly, we need to convert the figure to JSON format for frontend rendering. Returning the figure directly will not work - so utilizing the ",(0,a.jsx)(t.code,{children:"figure.to_json()"})," method is crucial."]}),"\n",(0,a.jsx)(t.h3,{id:"edit-the-widgetsjson-file",children:"Edit the widgets.json File"}),"\n",(0,a.jsxs)(t.p,{children:["Edit the ",(0,a.jsx)(t.code,{children:"widgets.json"})," file and add the following JSON data. This configuration defines the widget's properties and how it should be displayed:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-json",children:'{\n  "chains_plotly": {\n    "name": "Chains chart example",\n    "description": "Get current TVL of all chains and plot it!",\n    "category": "crypto",\n    "type": "chart",\n    "endpoint": "chains",\n    "gridData": {\n      "w": 20,\n      "h": 9\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(t.p,{children:["For more information on the ",(0,a.jsx)(t.code,{children:"widgets.json"})," file, see the ",(0,a.jsx)(t.a,{href:"/workspace/custom-backend/widgets-json-reference",children:"Widgets.json"})," page."]}),"\n",(0,a.jsx)(t.h2,{id:"step-3-run-the-application",children:"Step 3: Run the Application"}),"\n",(0,a.jsx)(t.p,{children:"Start the FastAPI Server using Uvicorn. This will host your backend locally:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"uvicorn main:app --host localhost --port 5050\n"})}),"\n",(0,a.jsx)(t.h2,{id:"step-4-add-to-openbb-pro",children:"Step 4: Add to OpenBB Pro"}),"\n",(0,a.jsxs)(t.p,{children:["Navigate to ",(0,a.jsx)(t.a,{href:"https://pro.openbb.co/app/data-connectors",children:"OpenBB Pro Data Connectors"})," and add your backend by clicking on the ",(0,a.jsx)(t.code,{children:"+ Add Data"})," button in the top right corner. Select ",(0,a.jsx)(t.code,{children:"Custom Backend"})," and fill in the details. Your URL will be ",(0,a.jsx)(t.code,{children:"http://localhost:5050"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["Once you have added your backend, you can find the widget in the ",(0,a.jsx)(t.code,{children:"Crypto"})," category with the name ",(0,a.jsx)(t.code,{children:"Chains chart example"}),"."]}),"\n",(0,a.jsx)("img",{className:"pro-border-gradient",width:"600",alt:"chart",src:"https://openbb-assets.s3.us-east-1.amazonaws.com/docs/pro/plotly-chart.png"}),"\n",(0,a.jsx)(t.h3,{id:"theme",children:"Theme"}),"\n",(0,a.jsx)(t.p,{children:'You can also switch the layout to light or dark mode by adding the "theme" parameter to the function. We send the current theme automatically to the backend and you can use it to switch the layout.'}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:'# Chart endpoint\n@app.get("/chains")\ndef get_chains(theme: str = "dark"):\n\n    ...\n    figure.update_layout(template="plotly_dark" if theme == "dark" else "plotly_white")\n    return json.loads(figure.to_json())\n'})}),"\n",(0,a.jsx)(t.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,a.jsxs)(t.p,{children:["You can find more examples of how to set up your own backend in the ",(0,a.jsx)(t.a,{href:"https://github.com/OpenBB-finance/backend-examples-for-openbb-workspace",children:"Backend for OpenBB Workspace GitHub"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);