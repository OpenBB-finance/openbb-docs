"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9860],{4275:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>d,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"workspace/developers/openbb-ai-sdk","title":"OpenBB AI SDK","description":"Build custom agents for OpenBB Workspace using the OpenBB AI SDK helpers and models","source":"@site/content/workspace/developers/openbb-ai-sdk.md","sourceDirName":"workspace/developers","slug":"/workspace/developers/openbb-ai-sdk","permalink":"/workspace/developers/openbb-ai-sdk","draft":false,"unlisted":false,"editUrl":"https://github.com/OpenBB-finance/openbb-docs/edit/main/content/workspace/developers/openbb-ai-sdk.md","tags":[],"version":"current","lastUpdatedBy":"DidierRLopes","lastUpdatedAt":1758203068000,"sidebarPosition":7,"frontMatter":{"title":"OpenBB AI SDK","sidebar_position":7,"description":"Build custom agents for OpenBB Workspace using the OpenBB AI SDK helpers and models","keywords":["OpenBB AI SDK","custom agents","SSE","QueryRequest","widgets","citations","charts","tables"]},"sidebar":"tutorialSidebar","previous":{"title":"Agents Integration","permalink":"/workspace/developers/agents-integration"},"next":{"title":"Share step-by-step reasoning","permalink":"/workspace/developers/ai-features/share-step-by-step-reasoning"}}');var i=s(74848),a=s(28453),r=s(39068);const d={title:"OpenBB AI SDK",sidebar_position:7,description:"Build custom agents for OpenBB Workspace using the OpenBB AI SDK helpers and models",keywords:["OpenBB AI SDK","custom agents","SSE","QueryRequest","widgets","citations","charts","tables"]},l=void 0,c={},o=[{value:"Request Handling",id:"request-handling",level:2},{value:"Streaming Text",id:"streaming-text",level:2},{value:"Reasoning Steps",id:"reasoning-steps",level:2},{value:"Widget Data Access",id:"widget-data-access",level:2},{value:"Parsing Widget Data",id:"parsing-widget-data",level:2},{value:"Data Attribution &amp; Citations",id:"data-attribution--citations",level:2},{value:"Visualizations",id:"visualizations",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.A,{title:"OpenBB AI SDK | OpenBB Workspace Docs"}),"\n",(0,i.jsx)(n.p,{children:"The OpenBB AI SDK simplifies building custom agents for OpenBB Workspace by providing type-safe models and helper functions that handle schema validation for streaming Server-Sent Events (SSE). Instead of manually crafting SSE messages and managing event types, you can use simple Python functions prepare events that will stream text, show reasoning steps, fetch widget data, and create visualizations."}),"\n",(0,i.jsx)(n.p,{children:"The SDK handles all the SSE formatting and data serialization for you."}),"\n",(0,i.jsx)(n.p,{children:"Install the package in your agent backend:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pip install openbb-ai\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The code is open source and is ",(0,i.jsx)(n.a,{href:"https://github.com/OpenBB-finance/openbb-ai",children:"available in this repository"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"request-handling",children:"Request Handling"}),"\n",(0,i.jsxs)(n.p,{children:["The SDK provides ",(0,i.jsx)(n.code,{children:"QueryRequest"})," to access everything your agent needs in a single, type-safe model:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from openbb_ai.models import QueryRequest\n\nasync def query(request: QueryRequest):\n    # Access chat history\n    messages = request.messages\n\n    # Access widgets (primary, secondary, extra)\n    widgets = request.widgets\n\n    # Use workspace context\n    timezone = request.timezone\n    workspace_state = request.workspace_state\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key fields in QueryRequest:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"messages"})," - chat conversation message history"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"widgets"})," - all widgets data","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"primary"})," - widgets added as explicit context"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"secondary"})," - widgets in the current dashboard"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"extra"})," - artifacts and files in the chat"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"urls"})," - URL pages shared in chat"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"timezone"})," - timezone identified by the user's browser"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools"})," - available MCP tools"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"workspace_options"})," - features enabled in the Workspace"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"workspace_state"})," - dashboard state and context","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"action_history"})," - user actions history"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents"})," - available agents"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"current_dashboard_uuid"})," - dashboard ID"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"current_dashboard_info"})," - dashboard metadata"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"current_page_context"})," - current page context"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"We recommend making backends stateless and not cache server state between calls."}),"\n",(0,i.jsx)(n.h2,{id:"streaming-text",children:"Streaming Text"}),"\n",(0,i.jsx)(n.p,{children:"The SDK simplifies streaming responses by handling SSE formatting automatically. You can yield message chunks like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from openbb_ai import message_chunk\n\n# Yield message chunks for the response stream\nfor chunk in llm_response:\n    yield message_chunk(chunk).model_dump()\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Related models:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MessageChunkSSE"})," - For streaming text/markdown tokens."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MessageArtifactSSE"})," - For streaming larger content blocks like tables or charts."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"reasoning-steps",children:"Reasoning Steps"}),"\n",(0,i.jsx)(n.p,{children:"Show users what your agent is thinking and doing with reasoning steps. The SDK handles the SSE event formatting:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from openbb_ai import reasoning_step\n\n# Show progress\nyield reasoning_step(event_type="INFO", message="Analyzing market data").model_dump()\n\n# Include details\nyield reasoning_step(\n    event_type="SUCCESS",\n    message="Data retrieved",\n    details={"records": 1000, "timeframe": "1Y"}\n).model_dump()\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Related models:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"StatusUpdateSSE"})," - Formats reasoning steps and status updates","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Event types: ",(0,i.jsx)(n.code,{children:"INFO"}),", ",(0,i.jsx)(n.code,{children:"SUCCESS"}),", ",(0,i.jsx)(n.code,{children:"WARNING"}),", ",(0,i.jsx)(n.code,{children:"ERROR"})]}),"\n",(0,i.jsx)(n.li,{children:"Optional details dictionary for key-value pairs"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"widget-data-access",children:"Widget Data Access"}),"\n",(0,i.jsx)(n.p,{children:"The SDK simplifies fetching data from dashboard widgets. Widget data is retrieved by yielding a special event that triggers a function call on the Workspace (client) side. Instead of manually creating these events, use the helper functions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from openbb_ai import get_widget_data\nfrom openbb_ai.models import WidgetRequest, Widget\n\n# Request data from multiple widgets\nwidget_requests = [\n    WidgetRequest(\n        widget=widget,\n        input_arguments={p.name: p.current_value for p in widget.params}\n    )\n]\n\n# SDK handles the SSE formatting\nyield get_widget_data(widget_requests).model_dump()\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Important: Once this event is sent, the execution loop of the agent should break and wait for the Workspace to call the ",(0,i.jsx)(n.code,{children:"/query"})," endpoint again with the widget data added to context."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Related models:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Widget"})," - Dashboard widget with metadata and parameters","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Contains widget ID, name, type"}),"\n",(0,i.jsx)(n.li,{children:"Includes parameter definitions"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WidgetParam"})," - Individual parameter configuration","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"name"})," - parameter identifier"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"type"})," - data type"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"current_value"})," - current value"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WidgetCollection"})," - Container for widget groups","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"primary"})," - user-selected widgets"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"secondary"})," - dashboard widgets"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"extra"})," - artifacts and files"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WidgetRequest"})," - Data request specification"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FunctionCallSSE"})," - The SSE that triggers widget data retrieval"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Widget features to declare in ",(0,i.jsx)(n.code,{children:"/agents.json"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"widget-dashboard-select"})," - access user-selected widgets. When true, the widgets explicitly added to context by the user appear in ",(0,i.jsx)(n.code,{children:"request.widgets.primary"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"widget-dashboard-search"})," - access dashboard widgets"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"parsing-widget-data",children:"Parsing Widget Data"}),"\n",(0,i.jsx)(n.p,{children:"When widgets return data, it comes in various formats that need to be parsed appropriately. The SDK provides data format models to identify and handle each type:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from openbb_ai.models import (\n    PdfDataFormat,\n    ImageDataFormat,\n    SpreadsheetDataFormat,\n    RawObjectDataFormat,\n    SingleDataContent,\n    SingleFileReference,\n    DataContent,\n    DataFileReferences\n)\n\nasync def handle_widget_data(data: list[DataContent | DataFileReferences]) -> str:\n    result_str = ""\n    for result in data:\n        for item in result.items:\n            if isinstance(item.data_format, PdfDataFormat):\n                # Parse PDF content\n                if isinstance(item, SingleDataContent):\n                    # Base64 encoded PDF\n                    content = base64.b64decode(item.content)\n                    # Extract text using pdfplumber or similar\n                elif isinstance(item, SingleFileReference):\n                    # PDF from URL\n                    content = await download_file(item.url)\n                    # Process PDF content\n\n            elif isinstance(item.data_format, SpreadsheetDataFormat):\n                # Parse Excel/CSV data\n                # Convert to dataframe or table structure\n\n            elif isinstance(item.data_format, ImageDataFormat):\n                # Handle image data\n                # May contain charts, screenshots, etc.\n\n            else:\n                # RawObjectDataFormat - JSON/dict data\n                result_str += str(item.content)\n\n    return result_str\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Data format models:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"PdfDataFormat"})," - Identifies PDF documents from widgets"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Contains filename and metadata"}),"\n",(0,i.jsx)(n.li,{children:"Data comes as base64 or URL reference"}),"\n",(0,i.jsxs)(n.li,{children:["Use libraries like ",(0,i.jsx)(n.code,{children:"pdfplumber"})," to extract text and tables"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"SpreadsheetDataFormat"})," - Identifies Excel/CSV data"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Tabular data from financial widgets"}),"\n",(0,i.jsxs)(n.li,{children:["Parse with ",(0,i.jsx)(n.code,{children:"pandas"})," or similar libraries"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ImageDataFormat"})," - Identifies image content"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Charts, graphs, screenshots from widgets"}),"\n",(0,i.jsx)(n.li,{children:"May require OCR or image analysis"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"RawObjectDataFormat"})," - Default JSON/dictionary format"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Structured data from API responses"}),"\n",(0,i.jsx)(n.li,{children:"Direct access to nested fields"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Data delivery models:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SingleDataContent"})," - Data embedded as base64"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SingleFileReference"})," - Data available via URL"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DataContent"})," - Container for multiple data items"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DataFileReferences"})," - References to external files"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"data-attribution--citations",children:"Data Attribution & Citations"}),"\n",(0,i.jsx)(n.p,{children:"The SDK makes it easy to cite your sources, ensuring transparency about where data comes from:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from openbb_ai import cite, citations\n\n# Create citations for widgets used\ncitation = cite(\n    widget=price_widget,\n    input_arguments={"symbol": "AAPL"},\n    extra_details={"timeframe": "1D"}\n)\n\n# Send all citations at once\nyield citations([citation]).model_dump()\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Related models:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Citation"})," - Links outputs to data sources","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"widget"})," - source widget reference"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"input_arguments"})," - parameters used"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"extra_details"})," - additional metadata"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SourceInfo"})," - Provides detailed source attribution"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CitationHighlightBoundingBox"})," - Visual highlighting for line-level citations in PDF documents"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"visualizations",children:"Visualizations"}),"\n",(0,i.jsx)(n.p,{children:"The SDK abstracts the complexity of creating interactive charts and tables. Simply provide your data and configuration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from openbb_ai import table, chart\n\n# Create a data table\nyield table(\n    data=[{"symbol": "AAPL", "price": 150.25, "change": 2.5}],\n    name="Stock Prices",\n    description="Current market prices"\n).model_dump()\n\n# Create interactive charts\nyield chart(\n    type="line",\n    data=price_history,\n    x_key="date",\n    y_keys=["price"],\n    name="Price History",\n    description="Stock price over time"\n).model_dump()\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Supported chart types and models:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"LineChartParameters"})," - Time series and trends"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"BarChartParameters"})," - Comparisons and distributions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ScatterChartParameters"})," - Correlations and relationships"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PieChartParameters"})," - Proportions and percentages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DonutChartParameters"})," - Hierarchical proportions"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>d});var t=s(96540);const i={},a=t.createContext(i);function r(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:n},e.children)}},39068:(e,n,s)=>{s.d(n,{A:()=>a});s(96540);var t=s(27143),i=s(74848);function a(e){let{title:n}=e;return(0,i.jsx)(t.A,{children:(0,i.jsx)("title",{children:n})})}}}]);